import{d as l}from"./chunk-FLR6VCGG.js";import{a as r}from"./chunk-H7Z7H6FO.js";import{Fc as u,H as i,L as a,Q as n,g as s}from"./chunk-BZMIPBVR.js";var p=class o{http=n(u);router=n(l);TOKEN_KEY="access_token";USER_KEY="current_user";currentUserSubject=new s(this.getUserFromStorage());currentUser$=this.currentUserSubject.asObservable();constructor(){}login(e){return this.http.post(`${r.apiUrl}/auth/login`,e,{withCredentials:!0}).pipe(i(t=>{this.setToken(t.access_token),this.setUser(t.user),this.currentUserSubject.next(t.user)}))}refreshToken(){return this.http.post(`${r.apiUrl}/auth/refresh`,{},{withCredentials:!0}).pipe(i(e=>{this.setToken(e.access_token)}))}logout(){this.getToken()?this.http.post(`${r.apiUrl}/auth/logout`,{},{withCredentials:!0}).subscribe({next:()=>{this.clearAuthData()},error:()=>{this.clearAuthData()}}):this.clearAuthData()}clearAuthData(){this.removeToken(),this.removeUser(),this.currentUserSubject.next(null),this.router.navigate(["/auth/login"])}isAuthenticated(){return!!this.getToken()}getToken(){return typeof window<"u"?localStorage.getItem(this.TOKEN_KEY):null}getCurrentUser(){return this.currentUserSubject.value}setToken(e){typeof window<"u"&&localStorage.setItem(this.TOKEN_KEY,e)}setUser(e){typeof window<"u"&&localStorage.setItem(this.USER_KEY,JSON.stringify(e))}removeToken(){typeof window<"u"&&localStorage.removeItem(this.TOKEN_KEY)}removeUser(){typeof window<"u"&&localStorage.removeItem(this.USER_KEY)}getUserFromStorage(){if(typeof window<"u"){let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}return null}static \u0275fac=function(t){return new(t||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{p as a};

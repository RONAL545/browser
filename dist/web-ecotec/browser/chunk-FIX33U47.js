import{a as _e,b as xe}from"./chunk-ZXC7XE54.js";import{a as be,b as he}from"./chunk-7F4KLB3X.js";import{b as k}from"./chunk-ADSAMHCS.js";import{a as ue}from"./chunk-EM3PZ2DS.js";import{c as le,d as de,e as fe,h as Ce,i as Se,j as ve,k as H}from"./chunk-6CKB7PEI.js";import{g as pe,h as ge,i as me}from"./chunk-MD5RATJP.js";import{L as ce,f as oe,h as ae,n as se}from"./chunk-QRAL5O2C.js";import{ra as re}from"./chunk-724CLJNZ.js";import{a as ne}from"./chunk-H7Z7H6FO.js";import{$a as l,Ab as O,Bb as s,Cb as S,Db as v,Dc as te,Eb as D,Ec as K,Fb as j,Fc as ie,Ga as T,Gb as z,Hb as A,Jb as F,L as Q,La as P,P as X,Qa as b,Sb as _,Tb as x,ab as n,bb as i,cb as p,ea as R,lb as N,nb as u,rc as I,uc as V,va as a,vc as ee,wc as E,xb as w,zb as q}from"./chunk-YLSQQ73F.js";import{a as J}from"./chunk-4CLCTAJ7.js";function ye(o,t){if(o&1&&(n(0,"p",8),s(1),_(2,"number"),i()),o&2){let e=u(2);a(),v("",x(2,1,e.metrics.peorSede.tasa,"1.1-1"),"% de cumplimiento")}}function Pe(o,t){o&1&&(n(0,"p",8),s(1,"Sin datos"),i())}function Oe(o,t){if(o&1&&(n(0,"div",2)(1,"div",3),p(2,"i",10),i(),n(3,"div",5)(4,"h3",6),s(5,"Sede con Peor Desempe\xF1o"),i(),n(6,"p",7),s(7),i(),b(8,ye,3,4,"p",11)(9,Pe,2,0,"p",11),i()()),o&2){let e=u();a(),w("background","linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"),a(6),S((e.metrics.peorSede==null?null:e.metrics.peorSede.nombre)||"-"),a(),l("ngIf",e.metrics.peorSede),a(),l("ngIf",!e.metrics.peorSede)}}function Ee(o,t){if(o&1&&(n(0,"p",8),s(1),_(2,"number"),i()),o&2){let e=u(2);a(),D(" ",e.metrics.peorEdificio.sede," - ",x(2,2,e.metrics.peorEdificio.tasa,"1.1-1"),"% ")}}function we(o,t){o&1&&(n(0,"p",8),s(1,"Sin datos"),i())}function Ie(o,t){if(o&1&&(n(0,"div",2)(1,"div",3),p(2,"i",12),i(),n(3,"div",5)(4,"h3",6),s(5,"Edificio con Peor Desempe\xF1o"),i(),n(6,"p",7),s(7),i(),b(8,Ee,3,5,"p",11)(9,we,2,0,"p",11),i()()),o&2){let e=u();a(),w("background","linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"),a(6),S((e.metrics.peorEdificio==null?null:e.metrics.peorEdificio.nombre)||"-"),a(),l("ngIf",e.metrics.peorEdificio),a(),l("ngIf",!e.metrics.peorEdificio)}}function ke(o,t){if(o&1&&(n(0,"p",8),s(1),_(2,"number"),i()),o&2){let e=u(2);a(),v("",x(2,1,e.metrics.mejorSede.tasa,"1.1-1"),"% de cumplimiento")}}function De(o,t){o&1&&(n(0,"p",8),s(1,"Sin datos"),i())}function Fe(o,t){if(o&1&&(n(0,"div",2)(1,"div",3),p(2,"i",10),i(),n(3,"div",5)(4,"h3",6),s(5,"Sede con Mejor Desempe\xF1o"),i(),n(6,"p",7),s(7),i(),b(8,ke,3,4,"p",11)(9,De,2,0,"p",11),i()()),o&2){let e=u();a(),w("background","linear-gradient(135deg, #10b981 0%, #059669 100%)"),a(6),S((e.metrics.mejorSede==null?null:e.metrics.mejorSede.nombre)||"-"),a(),l("ngIf",e.metrics.mejorSede),a(),l("ngIf",!e.metrics.mejorSede)}}function Re(o,t){if(o&1&&(n(0,"p",8),s(1),_(2,"number"),i()),o&2){let e=u(2);a(),D(" ",e.metrics.mejorEdificio.sede," - ",x(2,2,e.metrics.mejorEdificio.tasa,"1.1-1"),"% ")}}function Te(o,t){o&1&&(n(0,"p",8),s(1,"Sin datos"),i())}function Ne(o,t){if(o&1&&(n(0,"div",2)(1,"div",3),p(2,"i",12),i(),n(3,"div",5)(4,"h3",6),s(5,"Edificio con Mejor Desempe\xF1o"),i(),n(6,"p",7),s(7),i(),b(8,Re,3,5,"p",11)(9,Te,2,0,"p",11),i()()),o&2){let e=u();a(),w("background","linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)"),a(6),S((e.metrics.mejorEdificio==null?null:e.metrics.mejorEdificio.nombre)||"-"),a(),l("ngIf",e.metrics.mejorEdificio),a(),l("ngIf",!e.metrics.mejorEdificio)}}function je(o,t){if(o&1&&(n(0,"div",2)(1,"div",3),p(2,"i",13),i(),n(3,"div",5)(4,"h3",6),s(5,"Total Verificaciones (Hoy)"),i(),n(6,"p",7),s(7),i(),n(8,"p",8),s(9),_(10,"date"),i()()()),o&2){let e=u();a(),w("background","linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)"),a(6),S(e.metrics.totalVerificacionesHoy),a(2),S(x(10,4,e.currentDate,"dd/MM/yyyy"))}}var B=class o{registros=[];currentDate=null;hasSedeFilter=!1;hasEdificioFilter=!1;metrics={tasaSegregacion:0,peorSede:null,peorEdificio:null,mejorSede:null,mejorEdificio:null,totalVerificacionesHoy:0};ngOnChanges(t){(t.registros||t.currentDate)&&this.calculateMetrics()}calculateMetrics(){if(!this.registros||this.registros.length===0){this.metrics={tasaSegregacion:0,peorSede:null,peorEdificio:null,mejorSede:null,mejorEdificio:null,totalVerificacionesHoy:0};return}let t=0,e=0;this.registros.forEach(g=>{t+=6,g.plasticoSegregado&&e++,g.papelCartonSegregado&&e++,g.vidrioSegregado&&e++,g.metalSegregado&&e++,g.organicoSegregado&&e++,g.noAprovechableSegregado&&e++}),this.metrics.tasaSegregacion=e/t*100;let r=new Map;this.registros.forEach(g=>{let C=g.user?.sede?.nombre||"Sin sede";r.has(C)||r.set(C,{correctos:0,total:0});let h=r.get(C);h.total++,g.segregacionCorrecta&&h.correctos++});let m=null,d=null;r.forEach((g,C)=>{let h=g.correctos/g.total*100;(!m||h<m.tasa)&&(m={nombre:C,tasa:h}),(!d||h>d.tasa)&&(d={nombre:C,tasa:h})}),this.metrics.peorSede=m,this.metrics.mejorSede=d;let c=new Map;this.registros.forEach(g=>{let C=g.user?.edificio?.nombre||"Sin edificio",h=g.user?.sede?.nombre||"Sin sede",y=`${C}|${h}`;c.has(y)||c.set(y,{correctos:0,total:0,sede:h});let G=c.get(y);G.total++,g.segregacionCorrecta&&G.correctos++});let f=null,M=null;if(c.forEach((g,C)=>{let[h]=C.split("|"),y=g.correctos/g.total*100;(!f||y<f.tasa)&&(f={nombre:h,sede:g.sede,tasa:y}),(!M||y>M.tasa)&&(M={nombre:h,sede:g.sede,tasa:y})}),this.metrics.peorEdificio=f,this.metrics.mejorEdificio=M,this.currentDate){let g=new Date(this.currentDate).toDateString();this.metrics.totalVerificacionesHoy=this.registros.filter(C=>new Date(C.fechaVerificacion).toDateString()===g).length}else this.metrics.totalVerificacionesHoy=0}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-segregation-metrics"]],inputs:{registros:"registros",currentDate:"currentDate",hasSedeFilter:"hasSedeFilter",hasEdificioFilter:"hasEdificioFilter"},features:[R],decls:18,vars:11,consts:[[1,"segregation-metrics"],[1,"metrics-grid"],[1,"metric-card"],[1,"metric-icon"],[1,"pi","pi-percentage"],[1,"metric-content"],[1,"metric-title"],[1,"metric-value"],[1,"metric-subtitle"],["class","metric-card",4,"ngIf"],[1,"pi","pi-building"],["class","metric-subtitle",4,"ngIf"],[1,"pi","pi-home"],[1,"pi","pi-check-square"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),p(4,"i",4),i(),n(5,"div",5)(6,"h3",6),s(7,"Tasa de Segregaci\xF3n"),i(),n(8,"p",7),s(9),_(10,"number"),i(),n(11,"p",8),s(12,"KPI de cumplimiento"),i()()(),b(13,Oe,10,5,"div",9)(14,Ie,10,5,"div",9)(15,Fe,10,5,"div",9)(16,Ne,10,5,"div",9)(17,je,11,7,"div",9),i()()),e&2&&(a(3),w("background","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"),a(6),v("",x(10,8,r.metrics.tasaSegregacion,"1.1-1"),"%"),a(4),l("ngIf",!r.hasSedeFilter),a(),l("ngIf",!r.hasSedeFilter&&!r.hasEdificioFilter),a(),l("ngIf",!r.hasSedeFilter),a(),l("ngIf",!r.hasSedeFilter&&!r.hasEdificioFilter),a(),l("ngIf",r.currentDate))},dependencies:[E,I,k,pe,ee,V],styles:[".segregation-metrics[_ngcontent-%COMP%]{margin-bottom:clamp(1rem,3vw,2rem)}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(100%,250px),1fr));gap:clamp(1rem,3vw,1.5rem)}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:clamp(1rem,3vw,1.5rem);box-shadow:0 2px 8px #0000001a;display:flex;align-items:center;gap:clamp(1rem,3vw,1.5rem);transition:all .3s ease;min-width:0}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 8px 16px #00000026}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-icon[_ngcontent-%COMP%]{width:clamp(48px,12vw,64px);height:clamp(48px,12vw,64px);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:var(--text-3xl);color:#fff}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-content[_ngcontent-%COMP%]{flex:1;min-width:0;overflow:hidden}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-content[_ngcontent-%COMP%]   .metric-title[_ngcontent-%COMP%]{font-size:var(--text-sm);font-weight:var(--font-semibold);color:#64748b;text-transform:uppercase;letter-spacing:var(--tracking-wide);margin:0 0 .5rem;word-wrap:break-word;overflow-wrap:break-word;white-space:normal}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-content[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:var(--text-3xl);font-weight:var(--font-bold);color:#0f172a;margin:0 0 .25rem;line-height:var(--leading-tight);word-wrap:break-word;overflow-wrap:break-word;white-space:normal}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-content[_ngcontent-%COMP%]   .metric-subtitle[_ngcontent-%COMP%]{font-size:var(--text-sm);color:#64748b;margin:0;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;word-break:break-word}@media (max-width: 768px){.segregation-metrics[_ngcontent-%COMP%]{margin-bottom:1.5rem}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{padding:1rem;gap:1rem}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-icon[_ngcontent-%COMP%]{width:48px;height:48px}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .metric-content[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:var(--text-2xl)}}@media (max-width: 480px){.segregation-metrics[_ngcontent-%COMP%]{margin-bottom:1rem}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]{gap:.75rem}.segregation-metrics[_ngcontent-%COMP%]   .metrics-grid[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{padding:.875rem;gap:.875rem}}"],changeDetection:0})};var ze=()=>({height:"400px",width:"100%"}),Ae=()=>({height:"500px",width:"100%"});function Ve(o,t){if(o&1&&p(0,"p-chart",6),o&2){let e=u(2);q(F(4,ze)),l("data",e.pieChartData)("options",e.pieChartOptions)}}function He(o,t){if(o&1&&p(0,"p-chart",7),o&2){let e=u(2);q(F(4,Ae)),l("data",e.barChartData)("options",e.barChartOptions)}}function Be(o,t){if(o&1&&(n(0,"div",1)(1,"div",2)(2,"h3"),s(3,"Porcentaje de Segregaci\xF3n Correcta"),i(),n(4,"div",3),b(5,Ve,1,5,"p-chart",4),i()(),n(6,"div",2)(7,"h3"),s(8,"Segregaci\xF3n por Ubicaci\xF3n y Tipo de Residuo"),i(),n(9,"div",3),b(10,He,1,5,"p-chart",5),i()()()),o&2){let e=u();a(5),l("ngIf",e.pieChartData),a(5),l("ngIf",e.barChartData)}}function We(o,t){o&1&&(n(0,"div",1)(1,"p",8),s(2,"No hay datos disponibles. Aplica filtros para ver los gr\xE1ficos."),i()())}var L=class o{registros=[];currentFilters={};pieChartData=null;pieChartOptions=null;barChartData=null;barChartOptions=null;isInitialized=!1;ngOnChanges(t){t.registros&&this.registros&&this.registros.length>0?(!this.isInitialized||this.hasDataChanged(t.registros))&&(this.updateCharts(),this.isInitialized=!0):t.currentFilters&&this.isInitialized&&this.updateBarChart()}hasDataChanged(t){return t.previousValue?t.currentValue.length!==t.previousValue.length:!0}updateCharts(){if(!this.registros||this.registros.length===0){this.pieChartData=null,this.barChartData=null;return}this.updatePieChart(),this.updateBarChart()}updatePieChart(){let t=0,e=0;this.registros.forEach(c=>{t+=6,c.plasticoSegregado&&e++,c.papelCartonSegregado&&e++,c.vidrioSegregado&&e++,c.metalSegregado&&e++,c.organicoSegregado&&e++,c.noAprovechableSegregado&&e++});let r=t-e,m=e/t*100,d=r/t*100;this.pieChartData={labels:["Correctas","Incorrectas"],datasets:[{data:[m,d],backgroundColor:["#10b981","#ef4444"],borderWidth:0}]},this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:c=>{let f=c.label||"",M=c.parsed||0,g=f==="Correctas"?e:r;return`${f}: ${M.toFixed(1)}% (${g} verificaciones)`}}}}}}updateBarChart(){let t={plastico:"#f1e9e99c",organico:"#6f4e37",vidrio:"#808080",metal:"#ffeb00",papelCarton:"#1c5efb",noAprovechable:"#000000"},e=[],r=new Map;!this.currentFilters.sedeId&&!this.currentFilters.edificioId?(this.registros.forEach(c=>{let f=c.user?.sede?.nombre||"Sin sede";r.has(f)||r.set(f,this.createEmptyStats()),this.updateStats(r.get(f),c)}),e=Array.from(r.keys())):this.currentFilters.sedeId&&!this.currentFilters.edificioId?(this.registros.forEach(c=>{let f=c.user?.edificio?.nombre||"Sin edificio";r.has(f)||r.set(f,this.createEmptyStats()),this.updateStats(r.get(f),c)}),e=Array.from(r.keys())):this.currentFilters.sedeId&&this.currentFilters.edificioId&&(this.registros.forEach(c=>{let f=c.user?.edificio?.nombre||"Sin edificio";r.has(f)||r.set(f,this.createEmptyStats()),this.updateStats(r.get(f),c)}),e=Array.from(r.keys()));let m=[{label:"Pl\xE1stico - Correctos",backgroundColor:t.plastico,stack:"Si",data:e.map(c=>r.get(c).plasticoSi)},{label:"Org\xE1nico - Correctos",backgroundColor:t.organico,stack:"Si",data:e.map(c=>r.get(c).organicoSi)},{label:"Vidrio - Correctos",backgroundColor:t.vidrio,stack:"Si",data:e.map(c=>r.get(c).vidrioSi)},{label:"Metal - Correctos",backgroundColor:t.metal,stack:"Si",data:e.map(c=>r.get(c).metalSi)},{label:"Papel/Cart\xF3n - Correctos",backgroundColor:t.papelCarton,stack:"Si",data:e.map(c=>r.get(c).papelCartonSi)},{label:"No Aprovechable - Correctos",backgroundColor:t.noAprovechable,stack:"Si",data:e.map(c=>r.get(c).noAprovechableSi)},{label:"Pl\xE1stico - Incorrectos",backgroundColor:t.plastico,stack:"No",data:e.map(c=>r.get(c).plasticoNo)},{label:"Org\xE1nico - Incorrectos",backgroundColor:t.organico,stack:"No",data:e.map(c=>r.get(c).organicoNo)},{label:"Vidrio - Incorrectos",backgroundColor:t.vidrio,stack:"No",data:e.map(c=>r.get(c).vidrioNo)},{label:"Metal - Incorrectos",backgroundColor:t.metal,stack:"No",data:e.map(c=>r.get(c).metalNo)},{label:"Papel/Cart\xF3n - Incorrectos",backgroundColor:t.papelCarton,stack:"No",data:e.map(c=>r.get(c).papelCartonNo)},{label:"No Aprovechable - Incorrectos",backgroundColor:t.noAprovechable,stack:"No",data:e.map(c=>r.get(c).noAprovechableNo)}],d=e.map(c=>`${c} (S\xED, No)`);this.barChartData={labels:d,datasets:m},this.barChartOptions={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"N\xFAmero de Registros"}}},plugins:{legend:{display:!1},title:{display:!1},tooltip:{callbacks:{label:c=>{let f=c.dataset.label||"",M=c.parsed.y||0;return`${f}: ${M} registros`}}}}}}createEmptyStats(){return{plasticoSi:0,plasticoNo:0,organicoSi:0,organicoNo:0,vidrioSi:0,vidrioNo:0,metalSi:0,metalNo:0,papelCartonSi:0,papelCartonNo:0,noAprovechableSi:0,noAprovechableNo:0}}updateStats(t,e){e.plasticoSegregado?t.plasticoSi++:t.plasticoNo++,e.organicoSegregado?t.organicoSi++:t.organicoNo++,e.vidrioSegregado?t.vidrioSi++:t.vidrioNo++,e.metalSegregado?t.metalSi++:t.metalNo++,e.papelCartonSegregado?t.papelCartonSi++:t.papelCartonNo++,e.noAprovechableSegregado?t.noAprovechableSi++:t.noAprovechableNo++}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-segregation-summary"]],inputs:{registros:"registros",currentFilters:"currentFilters"},features:[R],decls:2,vars:2,consts:[["class","summary-segregation",4,"ngIf"],[1,"summary-segregation"],[1,"chart-card"],[1,"chart-wrapper"],["type","pie","class","chart-display",3,"data","options","style",4,"ngIf"],["type","bar",3,"data","options","style",4,"ngIf"],["type","pie",1,"chart-display",3,"data","options"],["type","bar",3,"data","options"],[1,"no-data"]],template:function(e,r){e&1&&b(0,Be,11,2,"div",0)(1,We,3,0,"div",0),e&2&&(l("ngIf",r.registros&&r.registros.length>0),a(),l("ngIf",!r.registros||r.registros.length===0))},dependencies:[E,I,be],styles:[".summary-segregation[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;margin:2rem 0}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1.5rem;box-shadow:0 2px 4px #0000001a}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem;font-weight:600;color:#0d2a72;text-align:center}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;min-height:400px;position:relative}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-wrapper[_ngcontent-%COMP%]   .chart-display[_ngcontent-%COMP%]{max-width:30rem;margin:0 auto}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-wrapper[_ngcontent-%COMP%]     canvas{max-width:100%!important;height:auto!important}.summary-segregation[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6c757d;font-size:1.1rem;background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.summary-segregation[_ngcontent-%COMP%]{gap:1.5rem;margin:1.5rem 0}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]{padding:1rem}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:1rem}.summary-segregation[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   .chart-wrapper[_ngcontent-%COMP%]{min-height:300px}}"],changeDetection:0})};var Le=()=>[10,25,50];function Ue(o,t){o&1&&(n(0,"tr")(1,"th",7),s(2,"Fecha "),p(3,"p-sortIcon",8),i(),n(4,"th",9),s(5,"Estudiante "),p(6,"p-sortIcon",10),i(),n(7,"th",11),s(8,"Sede "),p(9,"p-sortIcon",12),i(),n(10,"th",13),s(11,"Edificio "),p(12,"p-sortIcon",14),i(),n(13,"th",15),s(14,"Segregaci\xF3n Correcta "),p(15,"p-sortIcon",16),i(),n(16,"th",17),s(17,"Pl\xE1stico "),p(18,"p-sortIcon",18),i(),n(19,"th",19),s(20,"Papel "),p(21,"p-sortIcon",20),i(),n(22,"th",21),s(23,"Vidrio "),p(24,"p-sortIcon",22),i(),n(25,"th",23),s(26,"Metal "),p(27,"p-sortIcon",24),i(),n(28,"th",25),s(29,"Org\xE1nico "),p(30,"p-sortIcon",26),i(),n(31,"th",27),s(32,"No Aprovechable "),p(33,"p-sortIcon",28),i(),n(34,"th"),s(35,"Comentarios"),i()())}function $e(o,t){if(o&1&&(n(0,"tr")(1,"td"),s(2),_(3,"date"),i(),n(4,"td"),s(5),i(),n(6,"td"),s(7),i(),n(8,"td"),s(9),i(),n(10,"td",29)(11,"span"),s(12),i()(),n(13,"td",29)(14,"span"),s(15),i()(),n(16,"td",29)(17,"span"),s(18),i()(),n(19,"td",29)(20,"span"),s(21),i()(),n(22,"td",29)(23,"span"),s(24),i()(),n(25,"td",29)(26,"span"),s(27),i()(),n(28,"td",29)(29,"span"),s(30),i()(),n(31,"td")(32,"span",30),s(33),i()()()),o&2){let e=t.$implicit;a(2),S(x(3,27,e.fechaVerificacion,"dd/MM/yyyy")),a(3),D("",e.user==null?null:e.user.nombres," ",e.user==null?null:e.user.apellidos),a(2),S((e.user==null||e.user.sede==null?null:e.user.sede.nombre)||"-"),a(2),S((e.user==null||e.user.edificio==null?null:e.user.edificio.nombre)||"-"),a(2),O(e.segregacionCorrecta?"badge-success":"badge-error"),a(),v(" ",e.segregacionCorrecta?"S\xED":"No"," "),a(2),O(e.plasticoSegregado?"badge-success":"badge-error"),a(),v(" ",e.plasticoSegregado?"S\xED":"No"," "),a(2),O(e.papelCartonSegregado?"badge-success":"badge-error"),a(),v(" ",e.papelCartonSegregado?"S\xED":"No"," "),a(2),O(e.vidrioSegregado?"badge-success":"badge-error"),a(),v(" ",e.vidrioSegregado?"S\xED":"No"," "),a(2),O(e.metalSegregado?"badge-success":"badge-error"),a(),v(" ",e.metalSegregado?"S\xED":"No"," "),a(2),O(e.organicoSegregado?"badge-success":"badge-error"),a(),v(" ",e.organicoSegregado?"S\xED":"No"," "),a(2),O(e.noAprovechableSegregado?"badge-success":"badge-error"),a(),v(" ",e.noAprovechableSegregado?"S\xED":"No"," "),a(3),S(e.observaciones||"-")}}function qe(o,t){o&1&&(n(0,"tr")(1,"td",31),s(2,"No hay registros disponibles"),i()())}var U=class o{registros=[];loading=!1;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-registros-table"]],inputs:{registros:"registros",loading:"loading"},decls:8,vars:7,consts:[[1,"registros-table-section"],[1,"section-title"],[1,"pi","pi-list"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} registros","styleClass","p-datatable-sm","responsiveLayout","scroll",3,"value","loading","paginator","rows","showCurrentPageReport","rowsPerPageOptions"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pSortableColumn","fechaVerificacion"],["field","fechaVerificacion"],["pSortableColumn","user.nombres"],["field","user.nombres"],["pSortableColumn","user.sede.nombre"],["field","user.sede.nombre"],["pSortableColumn","user.edificio.nombre"],["field","user.edificio.nombre"],["pSortableColumn","segregacionCorrecta",1,"text-center"],["field","segregacionCorrecta"],["pSortableColumn","plasticoSegregado",1,"text-center"],["field","plasticoSegregado"],["pSortableColumn","papelCartonSegregado",1,"text-center"],["field","papelCartonSegregado"],["pSortableColumn","vidrioSegregado",1,"text-center"],["field","vidrioSegregado"],["pSortableColumn","metalSegregado",1,"text-center"],["field","metalSegregado"],["pSortableColumn","organicoSegregado",1,"text-center"],["field","organicoSegregado"],["pSortableColumn","noAprovechableSegregado",1,"text-center"],["field","noAprovechableSegregado"],[1,"text-center"],[1,"observaciones-text"],["colspan","12",1,"text-center"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"h2",1),p(2,"i",2),s(3," Todos los Registros de Segregaci\xF3n "),i(),n(4,"p-table",3),b(5,Ue,36,0,"ng-template",4)(6,$e,34,30,"ng-template",5)(7,qe,3,0,"ng-template",6),i()()),e&2&&(a(4),l("value",r.registros)("loading",r.loading)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",F(6,Le)))},dependencies:[E,H,Ce,re,Se,ve,k,V],styles:[".registros-table-section[_ngcontent-%COMP%]{margin-top:clamp(1rem,3vw,2rem);background:#fff;border-radius:8px;padding:clamp(1rem,3vw,1.5rem);box-shadow:0 2px 4px #0000001a}.registros-table-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:clamp(.5rem,2vw,.75rem);font-size:var(--text-xl);font-weight:var(--font-semibold);color:#0d2a72;margin:0 0 clamp(1rem,2vw,1.5rem) 0}.registros-table-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:clamp(1.25rem,3vw,1.5rem)}.registros-table-section[_ngcontent-%COMP%]   .badge-success[_ngcontent-%COMP%]{padding:clamp(.2rem,.5vw,.25rem) clamp(.5rem,1.5vw,.75rem);border-radius:12px;background:#d1fae5;color:#065f46;font-weight:var(--font-semibold);font-size:var(--text-xs);display:inline-block;white-space:nowrap}.registros-table-section[_ngcontent-%COMP%]   .badge-error[_ngcontent-%COMP%]{padding:clamp(.2rem,.5vw,.25rem) clamp(.5rem,1.5vw,.75rem);border-radius:12px;background:#fee2e2;color:#991b1b;font-weight:var(--font-semibold);font-size:var(--text-xs);display:inline-block;white-space:nowrap}.registros-table-section[_ngcontent-%COMP%]   .observaciones-text[_ngcontent-%COMP%]{display:block;max-width:300px;white-space:normal;word-wrap:break-word;font-size:var(--text-sm);color:#495057;line-height:1.5}  .registros-table-section .p-datatable .p-datatable-header{background:#f8f9fa;border:1px solid #e9ecef;padding:1rem;font-weight:var(--font-semibold)}  .registros-table-section .p-datatable .p-datatable-thead>tr>th{background-color:#0d2a72;color:#fff;border:1px solid #0a1f54;padding:1rem;font-weight:var(--font-semibold);font-size:var(--text-sm);text-align:left}  .registros-table-section .p-datatable .p-datatable-thead>tr>th.text-center{text-align:center}  .registros-table-section .p-datatable .p-datatable-thead>tr>th .p-sortable-column-icon{color:#fff;margin-left:.5rem}  .registros-table-section .p-datatable .p-datatable-thead>tr>th:hover{background-color:#0f3085}  .registros-table-section .p-datatable .p-datatable-tbody>tr{transition:background-color .2s ease}  .registros-table-section .p-datatable .p-datatable-tbody>tr:nth-child(2n){background-color:#f8f9fa}  .registros-table-section .p-datatable .p-datatable-tbody>tr:hover{background-color:#e9ecef}  .registros-table-section .p-datatable .p-datatable-tbody>tr>td{border:1px solid #e9ecef;padding:.875rem 1rem;font-size:var(--text-sm);color:#495057}  .registros-table-section .p-datatable .p-datatable-tbody>tr>td.text-center{text-align:center}  .registros-table-section .p-datatable .p-paginator{background:#f8f9fa;border:1px solid #e9ecef;padding:.5rem 1rem}  .registros-table-section .p-datatable .p-paginator .p-paginator-current{color:#495057;font-size:var(--text-sm)}  .registros-table-section .p-datatable .p-paginator .p-paginator-pages .p-paginator-page{min-width:2.5rem;height:2.5rem;border-radius:4px;color:#495057}  .registros-table-section .p-datatable .p-paginator .p-paginator-pages .p-paginator-page.p-highlight{background-color:#0d2a72;border-color:#0d2a72;color:#fff}  .registros-table-section .p-datatable .p-paginator .p-paginator-pages .p-paginator-page:hover:not(.p-highlight){background-color:#e9ecef}  .registros-table-section .p-datatable .p-paginator .p-dropdown{border-color:#ced4da}  .registros-table-section .p-datatable .p-paginator .p-dropdown:hover{border-color:#0d2a72}@media (max-width: 768px){.registros-table-section[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1rem}.registros-table-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:var(--text-lg);margin-bottom:1rem}.registros-table-section[_ngcontent-%COMP%]     .p-datatable{font-size:var(--text-xs)}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:.75rem .5rem;font-size:var(--text-xs);min-width:100px}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:.625rem .5rem;font-size:var(--text-xs);min-width:100px;max-height:3rem;overflow:hidden;line-height:1.4;word-break:break-word;white-space:nowrap;text-overflow:ellipsis}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-paginator{padding:.5rem;font-size:var(--text-xs)}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-paginator .p-paginator-pages .p-paginator-page{min-width:2rem;height:2rem}}@media (max-width: 480px){.registros-table-section[_ngcontent-%COMP%]{margin-top:1rem;padding:.75rem}.registros-table-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:var(--text-base);gap:.5rem;margin-bottom:.75rem}.registros-table-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-datatable-thead>tr>th{padding:.5rem .25rem;min-width:90px}.registros-table-section[_ngcontent-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:.5rem .25rem;min-width:90px;max-height:2.8rem}}"],changeDetection:0})};var $=class o{constructor(t){this.http=t}apiUrl=`${ne.apiUrl}/registros/segregation-report`;getHeaders(){let t=localStorage.getItem("access_token");return new te({Authorization:`Bearer ${t}`})}getReport(t){let e=new K;return t.sedeId&&(e=e.set("sedeId",t.sedeId)),t.edificioId&&(e=e.set("edificioId",t.edificioId)),t.fecha&&(e=e.set("fecha",t.fecha)),this.http.get(this.apiUrl,{params:e})}exportToExcel(t){let e=new K;t.sedeId&&(e=e.set("sedeId",t.sedeId)),t.edificioId&&(e=e.set("edificioId",t.edificioId)),t.fecha&&(e=e.set("fecha",t.fecha));let r=`${this.apiUrl}/export?${e.toString()}`;fetch(r,{headers:this.getHeaders().keys().reduce((m,d)=>(m[d]=this.getHeaders().get(d)||"",m),{})}).then(m=>m.blob()).then(m=>{let d=window.URL.createObjectURL(m),c=document.createElement("a");c.href=d,c.download=`reporte_segregacion_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(d)}).catch(m=>{console.error("Error al descargar el archivo:",m),alert("Error al exportar el archivo. Por favor, intente nuevamente.")})}static \u0275fac=function(e){return new(e||o)(X(ie))};static \u0275prov=Q({token:o,factory:o.\u0275fac,providedIn:"root"})};function Ye(o,t){o&1&&(n(0,"div",17),p(1,"i",18),n(2,"p"),s(3,"Cargando reporte..."),i()())}function Ze(o,t){if(o&1&&(n(0,"div"),p(1,"app-segregation-metrics",19)(2,"app-segregation-summary",20)(3,"app-registros-table",21),i()),o&2){let e=u();a(),l("registros",e.reportData.registros)("currentDate",e.selectedDate)("hasSedeFilter",!!e.selectedSedeId)("hasEdificioFilter",!!e.selectedEdificioId),a(),l("registros",e.reportData.registros)("currentFilters",e.currentFilters),a(),l("registros",e.reportData.registros)("loading",e.loading)}}var Me=class o{constructor(t,e,r){this.reportService=t;this.sedeService=e;this.edificioService=r;this.initChartOptions()}sedes=[];edificios=[];edificiosFiltrados=[];selectedSedeId=null;selectedEdificioId=null;selectedDate=null;reportData=null;loading=!1;currentFilters={};chartOptions;ngOnInit(){this.loadSedes(),this.loadEdificios(),this.loadReport()}initChartOptions(){this.chartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:t=>{let e=t.label||"",r=t.parsed||0;return`${e}: ${r.toFixed(1)}%`}}}}}}loadSedes(){this.sedeService.getSedes().subscribe({next:t=>{this.sedes=t},error:t=>{console.error("Error al cargar sedes:",t)}})}loadEdificios(){this.edificioService.getEdificios().subscribe({next:t=>{this.edificios=t,this.filterEdificios()},error:t=>{console.error("Error al cargar edificios:",t)}})}onSedeChange(){this.selectedEdificioId=null,this.filterEdificios()}filterEdificios(){this.selectedSedeId?this.edificiosFiltrados=this.edificios.filter(t=>t.sedeId===this.selectedSedeId):this.edificiosFiltrados=[...this.edificios]}loadReport(){this.loading=!0;let t={};this.selectedSedeId&&(t.sedeId=this.selectedSedeId),this.selectedEdificioId&&(t.edificioId=this.selectedEdificioId),this.selectedDate&&(t.fecha=this.selectedDate.toISOString().split("T")[0]),this.currentFilters=J({},t),this.reportService.getReport(t).subscribe({next:e=>{this.reportData=e,this.loading=!1},error:e=>{console.error("Error al cargar reporte:",e),this.loading=!1}})}clearFilters(){this.selectedSedeId=null,this.selectedEdificioId=null,this.selectedDate=null,this.filterEdificios(),this.loadReport()}getChartData(t){return{labels:["S\xED","No"],datasets:[{data:[t.porcentajeSi,t.porcentajeNo],backgroundColor:["#10b981","#ef4444"],borderWidth:0}]}}exportToExcel(){if(!this.reportData?.registros||this.reportData.registros.length===0){alert("No hay datos para exportar.");return}this.reportService.exportToExcel(this.currentFilters)}static \u0275fac=function(e){return new(e||o)(T($),T(_e),T(xe))};static \u0275cmp=P({type:o,selectors:[["app-segregation-report"]],decls:24,vars:15,consts:[[1,"segregation-report-page"],[1,"report-section"],[1,"section-title"],["filters","",1,"filters-grid"],[1,"filter-group"],["for","sede"],["id","sede","optionLabel","nombre","optionValue","id","placeholder","Todas las sedes","styleClass","w-full",3,"ngModelChange","ngModel","options","showClear"],["for","edificio"],["id","edificio","optionLabel","nombre","optionValue","id","placeholder","Todos los edificios","styleClass","w-full",3,"ngModelChange","ngModel","options","showClear","disabled"],["for","fecha"],["id","fecha","placeholder","dd/mm/aaaa","dateFormat","dd/mm/yy","appendTo","body","styleClass","w-full",3,"ngModelChange","ngModel","showIcon","showClear"],["actions",""],["label","Limpiar","variant","secondary","icon","pi pi-filter-slash",3,"onClick"],["label","Aplicar Filtros","variant","primary","icon","pi pi-search",3,"onClick","disabled","loading"],["label","Exportar Excel","variant","success","icon","pi pi-file-excel",3,"onClick","disabled"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],[1,"pi","pi-spin","pi-spinner",2,"font-size","3rem"],[3,"registros","currentDate","hasSedeFilter","hasEdificioFilter"],[3,"registros","currentFilters"],[3,"registros","loading"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"section",1)(2,"h2",2),s(3,"Reporte de Segregaci\xF3n"),i(),n(4,"app-filter-bar")(5,"div",3)(6,"div",4)(7,"label",5),s(8,"Sede"),i(),n(9,"p-select",6),A("ngModelChange",function(d){return z(r.selectedSedeId,d)||(r.selectedSedeId=d),d}),i()(),n(10,"div",4)(11,"label",7),s(12,"Edificio"),i(),n(13,"p-select",8),A("ngModelChange",function(d){return z(r.selectedEdificioId,d)||(r.selectedEdificioId=d),d}),i()(),n(14,"div",4)(15,"label",9),s(16,"Fecha"),i(),n(17,"p-datepicker",10),A("ngModelChange",function(d){return z(r.selectedDate,d)||(r.selectedDate=d),d}),i()()(),n(18,"div",11)(19,"app-button",12),N("onClick",function(){return r.clearFilters()}),i(),n(20,"app-button",13),N("onClick",function(){return r.loadReport()}),i(),n(21,"app-button",14),N("onClick",function(){return r.exportToExcel()}),i()()(),b(22,Ye,4,0,"div",15)(23,Ze,4,8,"div",16),i()()),e&2&&(a(9),j("ngModel",r.selectedSedeId),l("options",r.sedes)("showClear",!0),a(4),j("ngModel",r.selectedEdificioId),l("options",r.edificiosFiltrados)("showClear",!0)("disabled",!r.selectedSedeId),a(4),j("ngModel",r.selectedDate),l("showIcon",!0)("showClear",!0),a(3),l("disabled",r.loading)("loading",r.loading),a(),l("disabled",r.loading||!(!(r.reportData==null||r.reportData.registros==null)&&r.reportData.registros.length)),a(),l("ngIf",r.loading&&!r.reportData),a(),l("ngIf",r.reportData&&r.reportData.registros))},dependencies:[E,I,se,oe,ae,k,me,ge,de,le,ce,H,he,B,L,U,fe,ue],styles:[".segregation-report-page[_ngcontent-%COMP%]{padding:clamp(1rem,2vw,1.5rem);max-width:1400px;margin:0 auto}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]{margin-bottom:clamp(2rem,4vw,3rem)}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:clamp(1.25rem,2.5vw,1.75rem);font-weight:700;color:#0d2a72;margin:0 0 clamp(1rem,2vw,1.5rem) 0;padding-bottom:.75rem;border-bottom:3px solid #0D2A72}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;gap:1rem;background:var(--surface-card);border-radius:8px;box-shadow:0 2px 4px #0000001a;margin:1.5rem 0}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#666}@media (max-width: 768px){.segregation-report-page[_ngcontent-%COMP%]{padding:1rem}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]{margin-bottom:2rem}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom-width:2px}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:2rem}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}}@media (max-width: 480px){.segregation-report-page[_ngcontent-%COMP%]{padding:.75rem}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.segregation-report-page[_ngcontent-%COMP%]   .report-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.125rem}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{padding:1.5rem}.segregation-report-page[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}.stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(100%,250px),1fr));gap:clamp(1rem,3vw,1.5rem);margin-bottom:clamp(1rem,3vw,2rem)}@media (max-width: 768px){.stats-container[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}}@media (max-width: 480px){.stats-container[_ngcontent-%COMP%]{gap:.75rem}}"]})};export{Me as SegregationReportComponent};

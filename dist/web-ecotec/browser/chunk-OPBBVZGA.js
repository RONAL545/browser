import{d as u}from"./chunk-Q3PSKWJA.js";import{a as r}from"./chunk-H7Z7H6FO.js";import{Fc as l,H as n,L as a,Q as i,g as s}from"./chunk-YLSQQ73F.js";var c=class o{http=i(l);router=i(u);TOKEN_KEY="access_token";USER_KEY="current_user";currentUserSubject=new s(this.getUserFromStorage());currentUser$=this.currentUserSubject.asObservable();constructor(){}login(e){return console.log("AUTH SERVICE - Enviando login request:",e),this.http.post(`${r.apiUrl}/auth/login`,e,{withCredentials:!0}).pipe(n(t=>{console.log("AUTH SERVICE - Respuesta del servidor:",t),console.log("AUTH SERVICE - Access token:",t.access_token),console.log("AUTH SERVICE - User:",t.user),this.setToken(t.access_token),this.setUser(t.user),this.currentUserSubject.next(t.user)}))}refreshToken(){return this.http.post(`${r.apiUrl}/auth/refresh`,{},{withCredentials:!0}).pipe(n(e=>{this.setToken(e.access_token)}))}logout(){this.getToken()?this.http.post(`${r.apiUrl}/auth/logout`,{},{withCredentials:!0}).subscribe({next:()=>{this.clearAuthData()},error:()=>{this.clearAuthData()}}):this.clearAuthData()}clearAuthData(){this.removeToken(),this.removeUser(),this.currentUserSubject.next(null),this.router.navigate(["/auth/login"])}isAuthenticated(){return!!this.getToken()}getToken(){return typeof window<"u"?localStorage.getItem(this.TOKEN_KEY):null}getCurrentUser(){return this.currentUserSubject.value}setToken(e){typeof window<"u"&&localStorage.setItem(this.TOKEN_KEY,e)}setUser(e){typeof window<"u"&&localStorage.setItem(this.USER_KEY,JSON.stringify(e))}removeToken(){typeof window<"u"&&localStorage.removeItem(this.TOKEN_KEY)}removeUser(){typeof window<"u"&&localStorage.removeItem(this.USER_KEY)}getUserFromStorage(){if(typeof window<"u"){let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}return null}static \u0275fac=function(t){return new(t||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a};

<div class="edificio-management p-4">
  <div *ngIf="message" class="mb-4">
    <p-message
      [severity]="message.severity"
      [text]="message.text"
      styleClass="w-full">
    </p-message>
  </div>

  <!-- Sección de filtros y acciones -->
  <app-filter-bar>
    <div filters class="filter-group">
      <label for="sedeFilter">Filtrar por sede</label>
      <p-select
        id="sedeFilter"
        [(ngModel)]="selectedSede"
        [options]="sedes"
        optionLabel="nombre"
        placeholder="Todas las sedes"
        [showClear]="true"
        (onChange)="onSedeChange()">
      </p-select>
    </div>

    <div actions>
      <app-button
        label="Nuevo edificio"
        variant="success"
        icon="pi pi-plus"
        (onClick)="onAdd()"
        [disabled]="showForm">
      </app-button>
    </div>
  </app-filter-bar>

  <!-- Modal de Formulario -->
  <app-dialog
    [(visible)]="showForm"
    [title]="editMode ? 'Editar Edificio' : 'Nuevo Edificio'"
    [width]="'600px'"
    (onHide)="onCancel()">
    <div class="edificio-form">
      <div class="grid">
        <div class="col-12 md:col-6">
          <label for="edificioNombre" class="block text-sm font-semibold mb-2" style="color: #1f2937;">
            Nombre <span class="text-red-500">*</span>
          </label>
          <input
            id="edificioNombre"
            type="text"
            pInputText
            [(ngModel)]="edificioForm.nombre"
            placeholder="Ej: Edificio A"
            class="w-full" />
        </div>

        <div class="col-12 md:col-6">
          <label for="edificioSede" class="block text-sm font-semibold mb-2" style="color: #1f2937;">
            Sede <span class="text-red-500">*</span>
          </label>
          <p-select
            id="edificioSede"
            [(ngModel)]="edificioForm.sedeId"
            [options]="sedes"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Seleccionar sede"
            [scrollHeight]="'200px'"
            appendTo="body"
            styleClass="w-full">
          </p-select>
        </div>
      </div>

      <div class="button-container">
        <app-button
          label="Cancelar"
          variant="secondary"
          icon="pi pi-times"
          (onClick)="onCancel()">
        </app-button>
        <app-button
          label="Guardar"
          variant="primary"
          icon="pi pi-check"
          (onClick)="onSave()">
        </app-button>
      </div>
    </div>
  </app-dialog>

  <p-card class="shadow-1">

    <div class="table-container">
      <p-table
        [value]="edificios"
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} edificios"
        styleClass="p-datatable-sm"
        responsiveLayout="scroll">

        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="nombre" class="text-sm text-500 uppercase">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
            <th pSortableColumn="sede.nombre" class="text-sm text-500 uppercase">Sede <p-sortIcon field="sede.nombre"></p-sortIcon></th>
            <th class="text-center text-sm text-500 uppercase">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-edificio>
          <tr>
            <td>{{ edificio.nombre }}</td>
            <td>{{ edificio.sede?.nombre || '-' }}</td>
            <td class="text-center">
              <app-button
                icon="pi pi-pencil"
                variant="info"
                [rounded]="true"
                [iconOnly]="true"
                tooltip="Editar"
                (onClick)="onEdit(edificio)">
              </app-button>
              <app-button
                icon="pi pi-trash"
                variant="danger"
                [rounded]="true"
                [iconOnly]="true"
                tooltip="Eliminar"
                (onClick)="onDelete(edificio)">
              </app-button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center py-6 text-500">
              <i class="pi pi-inbox text-4xl mb-3 block"></i>
              {{ selectedSede ? 'No hay edificios en esta sede' : 'Aún no registras edificios' }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>

  <p-confirmDialog></p-confirmDialog>
</div>

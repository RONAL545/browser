<div class="edificio-management">
  <!-- Message -->
  <div *ngIf="message" class="mb-4">
    <p-message
      [severity]="message.severity"
      [text]="message.text"
      styleClass="w-full">
    </p-message>
  </div>

  <!-- Filtro por Sede y BotÃ³n Agregar -->
  <p-card>
    <div class="grid">
      <div class="col-12 md:col-8 lg:col-6">
        <label for="sedeFilter" class="block font-semibold mb-3">Filtrar por Sede</label>
        <p-select
          id="sedeFilter"
          [(ngModel)]="selectedSede"
          [options]="sedes"
          optionLabel="nombre"
          placeholder="Todas las sedes"
          [showClear]="true"
          (onChange)="onSedeChange()"
          styleClass="w-full">
        </p-select>
      </div>
      <div class="col-12 md:col-4 lg:col-6 flex align-items-end justify-content-end">
        <p-button
          label="Agregar Edificio"
          icon="pi pi-plus"
          (onClick)="onAdd()"
          [disabled]="showForm">
        </p-button>
      </div>
    </div>

    <!-- Formulario -->
    <div *ngIf="showForm" class="form-card mb-4">
      <h3 class="mb-3">{{ editMode ? 'Editar Edificio' : 'Nuevo Edificio' }}</h3>

      <div class="grid">
        <div class="col-12 md:col-6">
          <label for="edificioNombre" class="block mb-2 font-semibold">Nombre del Edificio *</label>
          <input
            id="edificioNombre"
            type="text"
            pInputText
            [(ngModel)]="edificioForm.nombre"
            placeholder="Ej: Edificio A"
            class="w-full"
          />
        </div>

        <div class="col-12 md:col-6">
          <label for="edificioSede" class="block mb-2 font-semibold">Sede *</label>
          <p-select
            id="edificioSede"
            [(ngModel)]="edificioForm.sedeId"
            [options]="sedes"
            optionLabel="nombre"
            optionValue="id"
            placeholder="Seleccionar sede"
            styleClass="w-full">
          </p-select>
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <p-button
          label="Guardar"
          icon="pi pi-check"
          (onClick)="onSave()">
        </p-button>
        <p-button
          label="Cancelar"
          icon="pi pi-times"
          severity="secondary"
          (onClick)="onCancel()">
        </p-button>
      </div>
    </div>

    <!-- Tabla de Edificios -->
    <div class="table-container">
      <p-table
        [value]="edificios"
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} edificios"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-sm"
        responsiveLayout="scroll">

        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
            <th pSortableColumn="sede.nombre">Sede <p-sortIcon field="sede.nombre"></p-sortIcon></th>
            <th class="text-center">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-edificio>
          <tr>
            <td>{{ edificio.nombre }}</td>
            <td>{{ edificio.sede?.nombre || '-' }}</td>
            <td class="text-center actions-cell">
              <button
                pButton
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-info"
                pTooltip="Editar"
                (click)="onEdit(edificio)"
              ></button>
              <button
                pButton
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-danger"
                pTooltip="Eliminar"
                (click)="onDelete(edificio)"
              ></button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="empty-message">
              <div class="no-data">
                <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc"></i>
                <p>{{ selectedSede ? 'No hay edificios en esta sede' : 'No hay edificios registrados' }}</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>
